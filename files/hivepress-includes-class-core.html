<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>HivePress Code Reference</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../images/favicon.png" />
    <link rel="apple-touch-icon" href="../images/apple-touch-icon.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="../images/apple-touch-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="../images/apple-touch-icon-114x114.png"/>
    <link rel="stylesheet" href="../css/normalize.css">
    <link rel="stylesheet" href="../css/base.css?updated=1729724201">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/template.css?updated=1729724201">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
            <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/js/all.min.js" integrity="sha256-0vuk8LXoyrmCjp1f0O300qo1M75ZQyhH9X3J6d+scmk=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@7.2.0/dist/js/autoComplete.min.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WB2WZE22L6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-WB2WZE22L6');
</script>
        <script src="../js/prism.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            window.dispatchEvent(new HashChangeEvent('hashchange'));
        });
    </script>
</head>
<body id="top">
    <header class="phpdocumentor-top-header">
    <section class="phpdocumentor-section">
        <div class="site-branding">
            <a class="site-logo" href="https://hivepress.io/"><img width="186" src="../images/logo.svg" alt="HivePress" /></a>
        </div>
        <nav class="main-navigation">
            <ul>
                <li><a href="../index.html">Home</a></li>
                <li><a href="https://hivepress.github.io/hook-reference/">Hook Reference</a></li>
                <li><a href="https://help.hivepress.io/">Knowledge Base</a></li>
            </ul>
        </nav>
    </section>
</header>
    
    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <aside class="phpdocumentor-column -four phpdocumentor-sidebar">
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Namespaces</h2>
                                <h3 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/default.html"><abbr title="\">Global</abbr></a></h3>
                                        <h4 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/hivepress.html"><abbr title="\HivePress">HivePress</abbr></a></h4>
                <ul class="phpdocumentor-list">
                                            <li><a href="../namespaces/hivepress-blocks.html"><abbr title="\HivePress\Blocks">Blocks</abbr></a></li>
                                            <li><a href="../namespaces/hivepress-components.html"><abbr title="\HivePress\Components">Components</abbr></a></li>
                                            <li><a href="../namespaces/hivepress-controllers.html"><abbr title="\HivePress\Controllers">Controllers</abbr></a></li>
                                            <li><a href="../namespaces/hivepress-emails.html"><abbr title="\HivePress\Emails">Emails</abbr></a></li>
                                            <li><a href="../namespaces/hivepress-fields.html"><abbr title="\HivePress\Fields">Fields</abbr></a></li>
                                            <li><a href="../namespaces/hivepress-forms.html"><abbr title="\HivePress\Forms">Forms</abbr></a></li>
                                            <li><a href="../namespaces/hivepress-helpers.html"><abbr title="\HivePress\Helpers">Helpers</abbr></a></li>
                                            <li><a href="../namespaces/hivepress-integrations.html"><abbr title="\HivePress\Integrations">Integrations</abbr></a></li>
                                            <li><a href="../namespaces/hivepress-menus.html"><abbr title="\HivePress\Menus">Menus</abbr></a></li>
                                            <li><a href="../namespaces/hivepress-models.html"><abbr title="\HivePress\Models">Models</abbr></a></li>
                                            <li><a href="../namespaces/hivepress-queries.html"><abbr title="\HivePress\Queries">Queries</abbr></a></li>
                                            <li><a href="../namespaces/hivepress-templates.html"><abbr title="\HivePress\Templates">Templates</abbr></a></li>
                                            <li><a href="../namespaces/hivepress-traits.html"><abbr title="\HivePress\Traits">Traits</abbr></a></li>
                                    </ul>
                        </section>

    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../indices/files.html">Files</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/markers.html">Markers</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/errors.html">Errors</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -eight phpdocumentor-content">
                    <ul class="phpdocumentor-breadcrumbs">
    </ul>

    <article class="phpdocumentor-element -file">
        <h2 class="phpdocumentor-content__title">class-core.php</h2>

                

        
                    <h3 class="phpdocumentor-elements__header" id="source-code">
                Source code
                <a href="#source-code" class="headerlink"><i class="fas fa-link"></i></a>
            </h3>
            <pre id="source-view" tabindex="-1" class="language-php line-numbers linkable-line-numbers"><code>&lt;?php
/**
 * HivePress core.
 *
 * @package HivePress
 */

namespace HivePress;

use HivePress\Helpers as hp;

// Exit if accessed directly.
defined( &#039;ABSPATH&#039; ) || exit;

/**
 * HivePress core class.
 */
final class Core {

	/**
	 * The single class instance.
	 *
	 * @var Core
	 */
	protected static $instance;

	/**
	 * HivePress extensions.
	 *
	 * @var array
	 */
	protected $extensions = [];

	/**
	 * HivePress configurations.
	 *
	 * @var array
	 */
	protected $configs = [];

	/**
	 * HivePress objects.
	 *
	 * @var array
	 */
	protected $objects = [];

	/**
	 * HivePress classes.
	 *
	 * @var array
	 */
	protected $classes = [];

	/**
	 * Forbid cloning instances.
	 */
	protected function __clone() {}

	/**
	 * Forbids unserializing instances.
	 *
	 * @throws \BadMethodCallException Invalid method.
	 */
	public function __wakeup() {
		throw new \BadMethodCallException();
	}

	/**
	 * Class constructor.
	 */
	protected function __construct() {

		// Autoload classes.
		spl_autoload_register( [ $this, &#039;autoload&#039; ] );

		// Activate HivePress.
		register_activation_hook( HP_FILE, [ __CLASS__, &#039;activate&#039; ] );

		// Deactivate HivePress.
		register_deactivation_hook( HP_FILE, [ __CLASS__, &#039;deactivate&#039; ] );

		// Install HivePress.
		add_action( &#039;init&#039;, [ $this, &#039;install&#039; ], 10000 );

		// Setup HivePress.
		add_action( &#039;plugins_loaded&#039;, [ $this, &#039;setup&#039; ], -10 );
	}

	/**
	 * Returns the single class instance.
	 *
	 * @see hivepress()
	 * @return Core
	 */
	public static function instance() {
		if ( is_null( self::$instance ) ) {
			self::$instance = new self();
		}

		return self::$instance;
	}

	/**
	 * Autoloads HivePress classes.
	 *
	 * @param string $class Class name.
	 */
	public function autoload( $class ) {
		$parts = explode( &#039;\\&#039;, str_replace( &#039;_&#039;, &#039;-&#039;, strtolower( $class ) ) );

		if ( count( $parts ) &gt; 1 &amp;&amp; reset( $parts ) === &#039;hivepress&#039; ) {
			$filename = &#039;class-&#039; . end( $parts ) . &#039;.php&#039;;

			array_shift( $parts );
			array_pop( $parts );

			foreach ( $this-&gt;get_paths() as $dir ) {
				$filepath = rtrim( $dir . &#039;/includes/&#039; . implode( &#039;/&#039;, $parts ), &#039;/&#039; ) . &#039;/&#039; . $filename;

				if ( file_exists( $filepath ) ) {
					require_once $filepath;

					if ( ! ( new \ReflectionClass( $class ) )-&gt;isAbstract() &amp;&amp; method_exists( $class, &#039;init&#039; ) &amp;&amp; ( new \ReflectionMethod( $class, &#039;init&#039; ) )-&gt;isStatic() ) {
						call_user_func( [ $class, &#039;init&#039; ] );
					}

					break;
				}
			}
		}
	}

	/**
	 * Activates HivePress plugin.
	 */
	public static function activate() {

		// Set activation flag.
		update_option( &#039;hp_core_activated&#039;, &#039;1&#039; );
	}

	/**
	 * Deactivates HivePress plugin.
	 */
	public static function deactivate() {

		/**
		 * Fires when HivePress plugin is deactivated.
		 *
		 * @hook hivepress/v1/deactivate
		 */
		do_action( &#039;hivepress/v1/deactivate&#039; );
	}

	/**
	 * Installs HivePress plugin.
	 */
	public function install() {
		if ( get_option( &#039;hp_core_activated&#039; ) || count( $this-&gt;extensions ) !== absint( get_option( &#039;hp_extensions_number&#039; ) ) ) {

			/**
			 * Fires when HivePress plugin is activated.
			 *
			 * @hook hivepress/v1/activate
			 */
			do_action( &#039;hivepress/v1/activate&#039; );

			// Unset activation flag.
			if ( get_option( &#039;hp_core_activated&#039; ) ) {
				update_option( &#039;hp_core_activated&#039;, &#039;&#039; );
			}

			// Update extensions number.
			if ( count( $this-&gt;extensions ) !== absint( get_option( &#039;hp_extensions_number&#039; ) ) ) {
				update_option( &#039;hp_extensions_number&#039;, count( $this-&gt;extensions ) );
			}

			// Set installation time.
			if ( ! get_option( &#039;hp_installed_time&#039; ) ) {
				update_option( &#039;hp_installed_time&#039;, time() );
			}
		}

		if ( ! get_option( &#039;hp_core_version&#039; ) || version_compare( get_option( &#039;hp_core_version&#039; ), $this-&gt;get_version(), &#039;&lt;&#039; ) ) {

			if ( get_option( &#039;hp_core_version&#039; ) ) {

				/**
				 * Fires when HivePress plugin is updated.
				 *
				 * @hook hivepress/v1/update
				 * @param {string} $version Previous version.
				 */
				do_action( &#039;hivepress/v1/update&#039;, get_option( &#039;hp_core_version&#039; ) );
			}

			// Update HivePress version.
			update_option( &#039;hp_core_version&#039;, $this-&gt;get_version() );
		}
	}

	/**
	 * Setups HivePress plugin.
	 */
	public function setup() {

		// Setup extensions.
		$this-&gt;setup_extensions();

		// Include helpers.
		require_once $this-&gt;get_path() . &#039;/includes/helpers.php&#039;;

		// Load textdomains.
		$this-&gt;load_textdomains();

		// Load packages.
		$this-&gt;load_packages();

		// Initialize components.
		$this-&gt;get_components();

		/**
		 * Fires when HivePress plugin is set up.
		 *
		 * @hook hivepress/v1/setup
		 */
		do_action( &#039;hivepress/v1/setup&#039; );
	}

	/**
	 * Setups HivePress extensions.
	 */
	protected function setup_extensions() {

		/**
		 * Filters the directory paths of HivePress extensions. You can register a new extension by adding its directory path to the filtered array.
		 *
		 * @hook hivepress/v1/extensions
		 * @param {array} $paths Directory paths.
		 * @return {array} Directory paths.
		 */
		$extensions = apply_filters( &#039;hivepress/v1/extensions&#039;, [ dirname( HP_FILE ) ] );

		// Add updater if available.
		if ( ! isset( $extensions[&#039;updates&#039;] ) ) {
			$path = &#039;/vendor/hivepress/hivepress-updates&#039;;

			foreach ( $extensions as $dir ) {
				if ( file_exists( $dir . $path . &#039;/hivepress-updates.php&#039; ) ) {
					$extensions[&#039;updates&#039;] = $dir . $path;

					break;
				}
			}
		}

		// Add extension details.
		foreach ( $extensions as $name =&gt; $dir ) {
			if ( is_array( $dir ) ) {

				// Add extension.
				$this-&gt;extensions[ $name ] = $dir;
			} else {

				// Get file path.
				$dirname  = basename( $dir );
				$filepath = $dir . &#039;/&#039; . $dirname . &#039;.php&#039;;

				// Get extension name.
				$name = str_replace( &#039;-&#039;, &#039;_&#039;, preg_replace( &#039;/^hivepress-/&#039;, &#039;&#039;, $dirname ) );

				if ( &#039;hivepress&#039; === $dirname ) {
					$name = &#039;core&#039;;
				}

				if ( file_exists( $filepath ) ) {

					// Get file data.
					$filedata = get_file_data(
						$filepath,
						[
							&#039;name&#039;    =&gt; &#039;Plugin Name&#039;,
							&#039;version&#039; =&gt; &#039;Version&#039;,
						]
					);

					// Add extension.
					$this-&gt;extensions[ $name ] = [
						&#039;name&#039;    =&gt; $filedata[&#039;name&#039;],
						&#039;version&#039; =&gt; $filedata[&#039;version&#039;],
						&#039;path&#039;    =&gt; $dir,
						&#039;url&#039;     =&gt; rtrim( plugin_dir_url( $filepath ), &#039;/&#039; ),
					];
				}
			}
		}
	}

	/**
	 * Loads text domains.
	 */
	protected function load_textdomains() {
		foreach ( $this-&gt;get_paths() as $dir ) {
			$dirname    = basename( $dir );
			$textdomain = hp\sanitize_slug( $dirname );

			load_plugin_textdomain( $textdomain, false, $dirname . &#039;/languages&#039; );
		}
	}

	/**
	 * Loads Composer packages.
	 */
	protected function load_packages() {
		foreach ( $this-&gt;get_paths() as $dir ) {
			$filepath = $dir . &#039;/vendor/autoload.php&#039;;

			if ( file_exists( $filepath ) ) {
				require_once $filepath;
			}
		}
	}

	/**
	 * Catches calls to undefined methods.
	 *
	 * @param string $name Method name.
	 * @param array  $args Method arguments.
	 * @throws \BadMethodCallException Invalid method.
	 * @return mixed
	 */
	public function __call( $name, $args ) {
		if ( strpos( $name, &#039;get_&#039; ) === 0 ) {

			// Get property name.
			$property = substr( $name, strlen( &#039;get_&#039; ) );

			if ( in_array( $property, [ &#039;name&#039;, &#039;version&#039;, &#039;path&#039;, &#039;url&#039; ], true ) ) {

				// Get extension name.
				$extension = &#039;core&#039;;

				if ( $args ) {
					$extension = hp\get_first_array_value( $args );
				}

				// Get property value.
				$value = null;

				if ( isset( $this-&gt;extensions[ $extension ][ $property ] ) ) {
					$value = $this-&gt;extensions[ $extension ][ $property ];
				}

				return $value;
			} else {

				// Set object type.
				$object_type = $property;

				if ( ! isset( $this-&gt;objects[ $object_type ] ) ) {
					$this-&gt;objects[ $object_type ] = [];

					foreach ( $this-&gt;get_paths() as $dir ) {
						foreach ( glob( $dir . &#039;/includes/&#039; . $object_type . &#039;/*.php&#039; ) as $filepath ) {

							// Get object name.
							$object_name = str_replace( &#039;-&#039;, &#039;_&#039;, preg_replace( &#039;/^class-/&#039;, &#039;&#039;, basename( $filepath, &#039;.php&#039; ) ) );

							// Create object.
							$object = hp\create_class_instance( &#039;\HivePress\\&#039; . $object_type . &#039;\\&#039; . $object_name );

							if ( $object ) {
								$this-&gt;objects[ $object_type ][ $object_name ] = $object;
							}
						}
					}
				}

				return $this-&gt;objects[ $object_type ];
			}
		}

		throw new \BadMethodCallException();
	}

	/**
	 * Catches getting undefined properties.
	 *
	 * @param string $name Property name.
	 * @return mixed
	 */
	public function __get( $name ) {
		return hp\get_array_value( $this-&gt;get_components(), $name );
	}

	/**
	 * Gets HivePress filepaths.
	 *
	 * @return array
	 */
	public function get_paths() {
		return array_column( $this-&gt;extensions, &#039;path&#039; );
	}

	/**
	 * Gets HivePress configuration.
	 *
	 * @param string $name Configuration name.
	 * @return array
	 */
	public function get_config( $name ) {
		if ( ! isset( $this-&gt;configs[ $name ] ) ) {
			$this-&gt;configs[ $name ] = [];

			foreach ( $this-&gt;get_paths() as $dir ) {
				$filepath = $dir . &#039;/includes/configs/&#039; . hp\sanitize_slug( $name ) . &#039;.php&#039;;

				if ( file_exists( $filepath ) ) {
					$this-&gt;configs[ $name ] = hp\merge_arrays( $this-&gt;configs[ $name ], include $filepath );
				}
			}

			/**
			 * Filters HivePress configuration. The dynamic part of the hook refers to the configuration name (e.g. `post_types`, `taxonomies`, `meta_boxes`). You can check the available configurations in the `includes/configs` directory of HivePress.
			 *
			 * @hook hivepress/v1/{config_name}
			 * @param {array} $config Configuration array.
			 * @return {array} Configuration array.
			 */
			$this-&gt;configs[ $name ] = apply_filters( &#039;hivepress/v1/&#039; . $name, $this-&gt;configs[ $name ] );
		}

		return $this-&gt;configs[ $name ];
	}

	/**
	 * Gets HivePress classes.
	 *
	 * @param string $namespace Class namespace.
	 * @return array
	 */
	public function get_classes( $namespace ) {
		if ( ! isset( $this-&gt;classes[ $namespace ] ) ) {
			$this-&gt;classes[ $namespace ] = [];

			foreach ( $this-&gt;get_paths() as $dir ) {
				foreach ( glob( $dir . &#039;/includes/&#039; . $namespace . &#039;/*.php&#039; ) as $filepath ) {

					// Get name.
					$name = str_replace( &#039;-&#039;, &#039;_&#039;, preg_replace( &#039;/^class-/&#039;, &#039;&#039;, basename( $filepath, &#039;.php&#039; ) ) );

					// Get class.
					$class = &#039;\HivePress\\&#039; . $namespace . &#039;\\&#039; . $name;

					if ( class_exists( $class ) &amp;&amp; ! ( new \ReflectionClass( $class ) )-&gt;isAbstract() ) {
						$this-&gt;classes[ $namespace ][ $name ] = $class;
					}
				}
			}
		}

		return $this-&gt;classes[ $namespace ];
	}
}
</code></pre>
            </article>
            </div>
        </div>
        <a href="#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <footer class="phpdocumentor phpdocumentor-footer">
    <div class="phpdocumentor-section">
        <span>HivePress Code Reference generated by <a href="http://www.phpdoc.org/">phpDocumentor</a> on October 23rd, 2024 at 10:56 pm.</span>
    </div>
</footer>

    <script>
        cssVars({});
    </script>
        </body>
</html>
